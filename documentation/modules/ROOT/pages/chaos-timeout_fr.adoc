:markup-in-source: verbatim,attributes,quotes
:CHE_URL: http://codeready-workspaces.%APPS_HOSTNAME_SUFFIX%
:USER_ID: %USER_ID%
:OPENSHIFT_PASSWORD: %OPENSHIFT_PASSWORD%
:OPENSHIFT_CONSOLE_URL: https://console-openshift-console.%APPS_HOSTNAME_SUFFIX%/topology/ns/chaos-engineering{USER_ID}/graph
:APPS_HOSTNAME_SUFFIX: %APPS_HOSTNAME_SUFFIX%
:KIALI_URL: https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%
:GRAFANA_URL: https://grafana-istio-system.%APPS_HOSTNAME_SUFFIX%

= Expérience Chaos 1: Injecting Timeout

_XX MINUTE PRACTICE_

== TODO

Pour minimiser l'impact de la latence, vous pouvez utiliser le modèle **timeout** qui est probablement le modèle de résilience le plus courant pour les systèmes distribués.
L'objectif est d'échouer une demande après une certaine période de temps pour éviter le verrouillage de code et de ressources lorsque le service attend une réponse qui prend trop de temps ou qui pourrait ne jamais arriver.

Dans le {KIALI_URL}[Kiali Console^], de la vue **'Services'**, cliquez sur les 'travels' Λ Actions' ACIA 'Request Timeouts'
image::kiali-request-timeout-actions.png[Kiali - Request Timeout Actions,900]

Ajouter HTTP Timeout en entrant les paramètres suivants:

.Réglages de timeout HTTP
[%header,cols=3*]
|===
|Paramètre
|Value
|Description

|Add HTTP Timeout
|**Enabled**
|

| Timeout
|**50ms**
|

|===

image::kiali-configure-timeout.png[Kiali - Configure Timeout,400]

Dans {GRAFANA_URL}[Grafana^], du **Chaos Engineering Dashboard**, faire défiler et voir les métriques de latence

Après un certain temps, vous pouvez voir l'impact de notre configuration. En effet, la latence du service **Voyages** a diminué et
les métriques de latence deviennent vertes à nouveau.

image::grafana-timeout-details-1.png[Grafana - Timeout Details,900]

image::grafana-timeout-details-2.png[Grafana - Timeout Details,900]

Les problèmes de latence ont été corrigés mais le calendrier introduit des erreurs pour les demandes qui dépassent le seuil.
Faire défiler et voir les paramètres du taux d'erreur

image::grafana-timeout-error.png[Grafana - Timeout Error,900]

== TODO

Vous avez mis en œuvre des délais pour le service de voyages.
Mettons en œuvre une stratégie de retry pour atténuer ces erreurs transitoires.

Dans le {KIALI_URL}[Kiali Console^], de la vue **'Services**,
cliquez sur les "voyages" Actions ^ 'Request Timeouts' et HTTP Retry en entrant les paramètres suivants:

.Réglages de rentrée HTTP
[%header,cols=3*]
|===
|Paramètre
|Value
|Description

|Add HTTP Retry
|**Enabled**
|

|Attempts
|**3**
|

|P Essayez le timeout
|**10ms**
|

|===

image::kiali-configure-retry.png[Kiali - Configure Retry,400]

Retour à {GRAFANA_URL}[Grafana^], vous pouvez dire que le motif de réécriture réduit les taux d'erreur sans impacter la latence.

.